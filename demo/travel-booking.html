<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CreateMyTrip - Travel Booking Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #E53E3E 0%, #1BA8E0 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 95vh;
        }

        .header {
            background: #FFFFFF;
            color: #333;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -1px;
            color: #E53E3E;
        }

        .logo .blue {
            color: #1BA8E0;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 500;
            flex: 1;
            color: #666;
        }

        .brand-badge {
            background: #1BA8E0;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #1BA8E0;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .interactive-component {
            margin-top: 15px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .calendar-heatmap {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 10px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }

        .month-header {
            grid-column: 1 / -1;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .day-cell {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
            font-weight: 500;
            position: relative;
            padding: 4px;
        }

        .day-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .day-cell.empty {
            background: #f0f0f0;
            cursor: default;
        }

        .day-cell.available {
            background: #e3f2fd;
            color: #1976d2;
        }

        .day-cell.cheap {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .day-cell.expensive {
            background: #ffcdd2;
            color: #c62828;
        }

        .day-cell.selected {
            background: #1BA8E0;
            color: white;
            box-shadow: 0 0 0 3px rgba(27, 168, 224, 0.3);
        }

        .day-cell.range-start, .day-cell.range-end {
            background: #1BA8E0;
            color: white;
        }

        .day-cell.range-middle {
            background: rgba(27, 168, 224, 0.3);
            color: #1BA8E0;
        }

        .price-label {
            font-size: 9px;
            margin-top: 2px;
        }

        .itinerary-card {
            background: linear-gradient(135deg, #E53E3E 0%, #1BA8E0 100%);
            color: white;
            border-radius: 12px;
            padding: 18px;
            margin-top: 15px;
            animation: slideUp 0.4s ease-out;
            border: 2px solid #1BA8E0;
        }

        .alternatives-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .alternative-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .alternative-card:hover {
            border-color: #1BA8E0;
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(27, 168, 224, 0.2);
        }

        .alternative-card.best-value {
            border-color: #1BA8E0;
            background: #f0f8ff;
        }

        .alternative-card.best-value::before {
            content: "Best Value";
            position: absolute;
            top: -10px;
            right: 15px;
            background: #1BA8E0;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .alternative-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .alternative-dates {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .alternative-price {
            font-size: 20px;
            font-weight: 700;
            color: #E53E3E;
        }

        .alternative-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 12px;
            color: #666;
        }

        .alternative-detail-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .alternative-image {
            width: 100%;
            height: 100px;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 12px;
            background: #f0f0f0;
        }

        .alternative-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .alternative-badge {
            display: inline-block;
            background: #e8f5e9;
            color: #2e7d32;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 8px;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .itinerary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .itinerary-title {
            font-size: 16px;
            font-weight: 600;
        }

        .itinerary-price {
            font-size: 22px;
            font-weight: 700;
        }

        .itinerary-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-icon {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .detail-icon img {
            width: 18px;
            height: 18px;
            filter: brightness(0) invert(1);
        }

        .detail-text {
            flex: 1;
        }

        .detail-label {
            font-size: 11px;
            opacity: 0.9;
        }

        .detail-value {
            font-size: 13px;
            font-weight: 600;
        }

        .itinerary-highlights {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .highlights-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .highlights-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .highlight-tag {
            background: rgba(255,255,255,0.2);
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 11px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: white;
            color: #E53E3E;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .traveler-form {
            background: white;
            border-radius: 10px;
            padding: 18px;
            margin-top: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .form-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: #1BA8E0;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .payment-form {
            background: white;
            border-radius: 10px;
            padding: 18px;
            margin-top: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .payment-method {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .payment-method:hover {
            border-color: #1BA8E0;
        }

        .payment-method.selected {
            border-color: #1BA8E0;
            background: #f0f8ff;
        }

        .payment-method img {
            width: 50px;
            height: 50px;
            margin-bottom: 8px;
            object-fit: contain;
        }

        .confirmation-card {
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
            color: white;
            border-radius: 16px;
            padding: 30px;
            margin-top: 15px;
            text-align: center;
        }

        .confirmation-icon {
            font-size: 64px;
            margin-bottom: 15px;
        }

        .confirmation-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .confirmation-details {
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
        }

        .confirmation-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .confirmation-row:last-child {
            border-bottom: none;
        }

        .input-container {
            padding: 20px 30px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .input-field {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 24px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .input-field:focus {
            border-color: #1BA8E0;
        }

        .send-btn {
            padding: 12px 24px;
            background: #1BA8E0;
            color: white;
            border: none;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .send-btn:hover {
            background: #1590c4;
            transform: translateY(-1px);
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 18px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .image-container {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            margin: 12px 0;
            max-height: 180px;
        }

        .image-container img {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chat-container" id="chatContainer">
            <div class="message bot">
                <div class="message-content">
                    <p>Hi! I can help you plan your perfect trip! ðŸŽ‰</p>
                </div>
            </div>
        </div>
        <div class="input-container">
            <input type="text" class="input-field" id="userInput" placeholder="Type your message..." onkeypress="handleKeyPress(event)">
            <button class="send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        let selectedStartDate = null;
        let selectedEndDate = null;
        let bookingStep = 0; // 0: calendar, 1: itinerary, 2: traveler details, 3: payment, 4: confirmation
        let currentTotalPrice = 0; // Store the calculated total price

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;

            addUserMessage(message);
            input.value = '';

            setTimeout(() => {
                processUserMessage(message);
            }, 500);
        }

        function typeAndSendMessage(msg, typingSpeed = 35) {
            const input = document.getElementById('userInput');
            const sendBtn = document.querySelector('.send-btn');
            input.value = '';
            let i = 0;
            const interval = setInterval(() => {
                input.value = msg.slice(0, i + 1);
                i++;
                if (i >= msg.length) {
                    clearInterval(interval);
                    setTimeout(() => {
                        if (sendBtn) sendBtn.click(); else sendMessage();
                    }, 200);
                }
            }, typingSpeed);
        }

        function addUserMessage(text) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `<div class="message-content">${text}</div>`;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showBotMessage(text) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = `<div class="message-content">${text}</div>`;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showTypingIndicator() {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.id = 'typingIndicator';
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function getMonthName(day) {
            return 'Nov';
        }

        function showCalendarHeatmap() {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const allDays = [];
            
            // November 2025 starts on Saturday (day 6)
            const novFirstDay = 6;
            const novDays = 30;
            
            // Store prices globally for calculation
            window.dayPrices = {};
            
            // Add empty cells for November
            for (let i = 0; i < novFirstDay; i++) {
                allDays.push({ day: '', empty: true, month: 'nov' });
            }
            
            const prices = {
                1: 35000, 2: 32000, 3: 28000, 4: 26000, 5: 24000,
                6: 22000, 7: 20000, 8: 19000, 9: 18500, 10: 18000,
                11: 17500, 12: 17000, 13: 16800, 14: 16500, 15: 16200,
                16: 16000, 17: 15800, 18: 16000, 19: 16500, 20: 17000,
                21: 18000, 22: 19000, 23: 20000, 24: 21000, 25: 22000,
                26: 23000, 27: 24000, 28: 25000, 29: 26000, 30: 27000
            };
            
            // November days
            for (let day = 1; day <= novDays; day++) {
                const price = prices[day] || 30000;
                window.dayPrices[day] = price; // Store price for this day
                let category = 'available';
                if (price < 18000) category = 'cheap';
                else if (price > 25000) category = 'expensive';
                
                allDays.push({ day, price, category, month: 'nov' });
            }
            
            let calendarHTML = `
                <div class="message-content">
                    <p><strong>ðŸ“… November 2025 - Price Calendar</strong></p>
                    <div class="interactive-component">
                        <div class="month-header">November 2025</div>
                        <div class="calendar-header">
                            ${days.map(d => `<div>${d}</div>`).join('')}
                        </div>
                        <div class="calendar-heatmap" id="calendarHeatmap">
            `;
            
            allDays.forEach((item) => {
                if (item.empty) {
                    calendarHTML += `<div class="day-cell empty"></div>`;
                } else {
                    const priceText = item.price < 1000 ? `â‚¹${item.price/1000}k` : `â‚¹${item.price}`;
                    calendarHTML += `
                        <div class="day-cell ${item.category}" 
                             data-day="${item.day}" 
                             data-month="${item.month}"
                             data-price="${item.price}"
                             onclick="selectDate(${item.day}, '${item.month}')">
                            <div>${item.day}</div>
                            <div class="price-label">${priceText}</div>
                        </div>
                    `;
                }
            });
            
            calendarHTML += `
                        </div>
                        <div style="margin-top: 15px; font-size: 12px; color: #666;">
                            <div style="display: flex; gap: 15px; justify-content: center;">
                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #c8e6c9; border-radius: 3px; margin-right: 5px;"></span>Cheap</div>
                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #e3f2fd; border-radius: 3px; margin-right: 5px;"></span>Moderate</div>
                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #ffcdd2; border-radius: 3px; margin-right: 5px;"></span>Expensive</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            messageDiv.innerHTML = calendarHTML;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            enableDragSelection();
        }

        function enableDragSelection() {
            let isDragging = false;
            const cells = document.querySelectorAll('.day-cell:not(.empty)');
            
            cells.forEach(cell => {
                cell.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    isDragging = true;
                    const day = parseInt(cell.dataset.day);
                    selectedStartDate = day;
                    selectedEndDate = day;
                    updateSelection();
                });
                
                cell.addEventListener('mouseenter', () => {
                    if (isDragging && selectedStartDate) {
                        const day = parseInt(cell.dataset.day);
                        selectedEndDate = day;
                        updateSelection();
                    }
                });
            });
            
            document.addEventListener('mouseup', () => {
                if (isDragging && selectedStartDate && selectedEndDate) {
                    isDragging = false;
                    const start = Math.min(selectedStartDate, selectedEndDate);
                    const end = Math.max(selectedStartDate, selectedEndDate);
                    const days = end - start + 1;
                    
                    if (days >= 5 && days <= 7) {
                        setTimeout(() => showItineraryCard(start, end), 500);
                    } else {
                        showBotMessage(`Please select 5-7 days for your trip. You selected ${days} days.`);
                    }
                }
            });
        }

        function selectDate(day, month = 'nov') {
            selectedStartDate = day;
            selectedEndDate = day;
            updateSelection();
            
            if (day >= 12 && day <= 18) {
                selectedStartDate = 12;
                selectedEndDate = 18;
                updateSelection();
                setTimeout(() => showItineraryCard(12, 18), 500);
            }
        }

        function updateSelection() {
            const cells = document.querySelectorAll('.day-cell:not(.empty)');
            cells.forEach(cell => {
                cell.classList.remove('selected', 'range-start', 'range-end', 'range-middle');
                const day = parseInt(cell.dataset.day);
                
                if (selectedStartDate && selectedEndDate) {
                    const start = Math.min(selectedStartDate, selectedEndDate);
                    const end = Math.max(selectedStartDate, selectedEndDate);
                    
                    if (day === start) {
                        cell.classList.add('selected', 'range-start');
                    } else if (day === end) {
                        cell.classList.add('selected', 'range-end');
                    } else if (day > start && day < end) {
                        cell.classList.add('range-middle');
                    }
                }
            });
        }

        function showItineraryCard(startDay, endDay, customPrice = null) {
            bookingStep = 1;
            const days = endDay - startDay + 1;
            
            // Calculate total price as sum of prices for selected days
            let totalPrice = 0;
            if (customPrice) {
                totalPrice = customPrice;
            } else {
                for (let day = startDay; day <= endDay; day++) {
                    totalPrice += (window.dayPrices && window.dayPrices[day]) || 17000;
                }
            }
            
            currentTotalPrice = totalPrice; // Store for payment form
            const month = 'Nov';
            
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                const container = document.getElementById('chatContainer');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <p>Perfect! Here's your <strong>CreateMyTrip</strong> itinerary for ${month} ${startDay}-${endDay}:</p>
                    <div class="itinerary-card">
                        <div class="itinerary-header">
                            <div class="itinerary-title">Goa Trip Package</div>
                            <div class="itinerary-price">â‚¹${totalPrice.toLocaleString()}</div>
                        </div>
                        <div class="itinerary-details">
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <img src="https://cdn-icons-png.flaticon.com/512/1829/1829234.png" alt="Flight">
                                </div>
                                <div class="detail-text">
                                    <div class="detail-label">Flight</div>
                                    <div class="detail-value">BLR â†’ GOI (Round Trip)</div>
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <img src="https://cdn-icons-png.flaticon.com/512/1829/1829234.png" alt="Hotel">
                                </div>
                                <div class="detail-text">
                                    <div class="detail-label">Hotel</div>
                                    <div class="detail-value">4â˜… Beach Resort (${days} nights)</div>
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <img src="https://cdn-icons-png.flaticon.com/512/1829/1829234.png" alt="Duration">
                                </div>
                                <div class="detail-text">
                                    <div class="detail-label">Duration</div>
                                    <div class="detail-value">${days} days, ${days-1} nights</div>
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <img src="https://cdn-icons-png.flaticon.com/512/1829/1829234.png" alt="Price">
                                </div>
                                <div class="detail-text">
                                    <div class="detail-label">Price for couple</div>
                                    <div class="detail-value">â‚¹${totalPrice.toLocaleString()}</div>
                                </div>
                            </div>
                        </div>
                        <div class="image-container">
                            <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800&h=300&fit=crop" alt="Goa Beach">
                        </div>
                        <div class="itinerary-highlights">
                            <div class="highlights-title">âœ¨ What's Included:</div>
                            <div class="highlights-list">
                                <span class="highlight-tag">Breakfast Included</span>
                                <span class="highlight-tag">Airport Transfer</span>
                                <span class="highlight-tag">Beach Access</span>
                                <span class="highlight-tag">Free WiFi</span>
                                <span class="highlight-tag">Pool Access</span>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="showTravelerForm()">Continue to Booking</button>
                            <button class="btn btn-secondary" onclick="showAlternatives()">See Alternatives</button>
                        </div>
                    </div>
                </div>
            `;
            
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }, 1000);
        }

        function showTravelerForm() {
            bookingStep = 2;
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                const container = document.getElementById('chatContainer');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <p>Great! Let's get your traveler details to complete the booking:</p>
                    <div class="traveler-form">
                        <div class="form-title">Traveler Information</div>
                        <form id="travelerForm" onsubmit="handleTravelerSubmit(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">First Name *</label>
                                    <input type="text" class="form-input" name="firstName" id="firstName" required placeholder="Enter first name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Last Name *</label>
                                    <input type="text" class="form-input" name="lastName" id="lastName" required placeholder="Enter last name">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Email *</label>
                                    <input type="email" class="form-input" name="email" id="email" required placeholder="Enter email address">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Phone *</label>
                                    <input type="tel" class="form-input" name="phone" id="phone" required placeholder="Enter phone number">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date of Birth *</label>
                                <input type="date" class="form-input" name="dob" id="dob" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Passport Number (Optional)</label>
                                <input type="text" class="form-input" name="passport" id="passport" placeholder="Enter passport number">
                            </div>
                            <div class="action-buttons" style="margin-top: 20px;">
                                <button type="submit" class="btn btn-primary" id="submitBtn" style="flex: 1;" disabled>Continue to Payment</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
                
                // Auto-fill form with typing simulation
                setTimeout(() => {
                    autoFillTravelerForm();
                }, 500);
            }, 1000);
        }

        function typeText(input, text, callback) {
            let index = 0;
            const interval = setInterval(() => {
                if (index < text.length) {
                    input.value = text.substring(0, index + 1);
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                    index++;
                } else {
                    clearInterval(interval);
                    if (callback) callback();
                }
            }, 50); // Typing speed: 50ms per character
        }

        function autoFillTravelerForm() {
            const firstName = document.getElementById('firstName');
            const lastName = document.getElementById('lastName');
            const email = document.getElementById('email');
            const phone = document.getElementById('phone');
            const dob = document.getElementById('dob');
            const passport = document.getElementById('passport');
            const submitBtn = document.getElementById('submitBtn');

            if (!firstName) return;

            // Simulate typing in sequence
            typeText(firstName, 'Gaurav', () => {
                setTimeout(() => {
                    typeText(lastName, 'Jain', () => {
                        setTimeout(() => {
                            typeText(email, 'gaurav.jain@example.com', () => {
                                setTimeout(() => {
                                    typeText(phone, '+91 98765 43210', () => {
                                        setTimeout(() => {
                                            // Set date directly (no typing simulation for date picker)
                                            if (dob) {
                                                dob.value = '1990-05-15';
                                                dob.dispatchEvent(new Event('change', { bubbles: true }));
                                            }
                                            setTimeout(() => {
                                                typeText(passport, 'A12345678', () => {
                                                    setTimeout(() => {
                                                        if (submitBtn) {
                                                            submitBtn.disabled = false;
                                                            submitBtn.style.opacity = '1';
                                                        }
                                                    }, 300);
                                                });
                                            }, 200);
                                        }, 200);
                                    });
                                }, 200);
                            });
                        }, 200);
                    });
                }, 200);
            });
        }

        function handleTravelerSubmit(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const travelerData = Object.fromEntries(formData);
            
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                showPaymentForm(travelerData);
            }, 1000);
        }

        function showPaymentForm(travelerData) {
            bookingStep = 3;
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                const container = document.getElementById('chatContainer');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <p>Perfect! Now let's complete the payment:</p>
                    <div class="payment-form">
                        <div class="form-title">Payment Details</div>
                        <div class="payment-methods" id="paymentMethods">
                            <div class="payment-method" onclick="selectPaymentMethod('card', this)">
                                <img src="https://cdn-icons-png.flaticon.com/512/349/349221.png" alt="Card">
                                <div style="font-size: 12px; margin-top: 5px; font-weight: 600;">Card</div>
                            </div>
                            <div class="payment-method" onclick="selectPaymentMethod('upi', this)">
                                <img src="https://cdn-icons-png.flaticon.com/512/888/888857.png" alt="UPI">
                                <div style="font-size: 12px; margin-top: 5px; font-weight: 600;">UPI</div>
                            </div>
                            <div class="payment-method" onclick="selectPaymentMethod('wallet', this)">
                                <img src="https://cdn-icons-png.flaticon.com/512/888/888871.png" alt="Wallet">
                                <div style="font-size: 12px; margin-top: 5px; font-weight: 600;">Wallet</div>
                            </div>
                        </div>
                        <div id="paymentDetails" style="margin-top: 20px; display: none;">
                            <div class="form-group">
                                <label class="form-label">Card Number</label>
                                <input type="text" class="form-input" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Expiry Date</label>
                                    <input type="text" class="form-input" id="expiry" placeholder="MM/YY" maxlength="5">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">CVV</label>
                                    <input type="text" class="form-input" id="cvv" placeholder="123" maxlength="3">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cardholder Name</label>
                                <input type="text" class="form-input" id="cardName" placeholder="${travelerData.firstName} ${travelerData.lastName}">
                            </div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Package Price (for couple)</span>
                                <span>â‚¹${currentTotalPrice.toLocaleString()}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Taxes & Fees</span>
                                <span>â‚¹${Math.round(currentTotalPrice * 0.1).toLocaleString()}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 18px; padding-top: 10px; border-top: 2px solid #e0e0e0;">
                                <span>Total</span>
                                <span>â‚¹${(currentTotalPrice + Math.round(currentTotalPrice * 0.1)).toLocaleString()}</span>
                            </div>
                        </div>
                        <div class="action-buttons" style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="processPayment()" id="payBtn" disabled>Pay â‚¹${(currentTotalPrice + Math.round(currentTotalPrice * 0.1)).toLocaleString()}</button>
                        </div>
                    </div>
                </div>
            `;
            
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }, 1000);
        }

        function selectPaymentMethod(method, element) {
            document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            
            const detailsDiv = document.getElementById('paymentDetails');
            const payBtn = document.getElementById('payBtn');
            
            if (method === 'card') {
                detailsDiv.style.display = 'block';
                payBtn.disabled = false;
            } else {
                detailsDiv.style.display = 'none';
                payBtn.disabled = false;
            }
        }

        function processPayment() {
            bookingStep = 4;
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                showConfirmation();
            }, 2000);
        }

        function showConfirmation() {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="confirmation-card">
                        <div class="confirmation-icon">âœ…</div>
                        <div class="confirmation-title">Booking Confirmed!</div>
                        <p style="opacity: 0.9; margin-bottom: 20px;">Your <strong>CreateMyTrip</strong> booking is confirmed! Your trip to Goa is all set. Booking details have been sent to your email.</p>
                        <div class="confirmation-details">
                            <div class="confirmation-row">
                                <span>Booking ID</span>
                                <span style="font-weight: 600;">CMT-2025-001234</span>
                            </div>
                            <div class="confirmation-row">
                                <span>Trip Dates</span>
                                <span style="font-weight: 600;">Nov 12-18, 2025</span>
                            </div>
                            <div class="confirmation-row">
                                <span>Travelers</span>
                                <span style="font-weight: 600;">2 Adults</span>
                            </div>
                            <div class="confirmation-row">
                                <span>Total Amount</span>
                                <span style="font-weight: 600;">â‚¹${(currentTotalPrice + Math.round(currentTotalPrice * 0.1)).toLocaleString()}</span>
                            </div>
                            <div class="confirmation-row">
                                <span>Payment Status</span>
                                <span style="font-weight: 600; color: #4caf50;">Paid</span>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2);">
                            <p style="font-size: 14px; opacity: 0.9;">You'll receive flight and hotel vouchers via email within 24 hours. Thank you for choosing <strong>CreateMyTrip</strong>! Have a great trip! ðŸŽ‰</p>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showAlternatives() {
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                const container = document.getElementById('chatContainer');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
            
            // Calculate prices for alternatives based on day prices
            const calculatePrice = (startDay, endDay) => {
                let total = 0;
                for (let day = startDay; day <= endDay; day++) {
                    total += (window.dayPrices && window.dayPrices[day]) || 17000;
                }
                return total;
            };
            
            const alternatives = [
                { dates: 'Nov 10-16', startDay: 10, endDay: 16, days: 6, image: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=200&fit=crop', hotel: '4â˜… Resort', flight: 'Direct' },
                { dates: 'Nov 12-18', startDay: 12, endDay: 18, days: 6, image: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=200&fit=crop', hotel: '4â˜… Beach Resort', flight: 'Direct', bestValue: true },
                { dates: 'Nov 15-21', startDay: 15, endDay: 21, days: 6, image: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=200&fit=crop', hotel: '4â˜… Resort', flight: 'Direct' },
                { dates: 'Nov 8-14', startDay: 8, endDay: 14, days: 6, image: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=200&fit=crop', hotel: '5â˜… Luxury', flight: 'Direct' }
            ];
            
            // Calculate prices for each alternative
            alternatives.forEach(alt => {
                alt.price = calculatePrice(alt.startDay, alt.endDay);
                const basePrice = calculatePrice(12, 18); // Best value price
                alt.savings = `â‚¹${(basePrice - alt.price).toLocaleString()}`;
            });
            
            let alternativesHTML = `
                <div class="message-content">
                    <p><strong>CreateMyTrip</strong> has found these great alternatives for your Goa trip:</p>
                    <div class="alternatives-grid">
            `;
            
            alternatives.forEach((alt, index) => {
                alternativesHTML += `
                    <div class="alternative-card ${alt.bestValue ? 'best-value' : ''}" onclick="selectAlternative(${index}, '${alt.dates}', ${alt.price})">
                        <div class="alternative-image">
                            <img src="${alt.image}" alt="Goa Package">
                        </div>
                        <div class="alternative-header">
                            <div class="alternative-dates">${alt.dates}</div>
                            <div class="alternative-price">â‚¹${alt.price.toLocaleString()}</div>
                        </div>
                        <div class="alternative-details">
                            <div class="alternative-detail-item">
                                <span>ðŸ“…</span>
                                <span>${alt.days} days</span>
                            </div>
                            <div class="alternative-detail-item">
                                <span>ðŸ¨</span>
                                <span>${alt.hotel}</span>
                            </div>
                            <div class="alternative-detail-item">
                                <span>âœˆï¸</span>
                                <span>${alt.flight}</span>
                            </div>
                            <div class="alternative-detail-item">
                                <span>ðŸ’°</span>
                                <span>Save ${alt.savings}</span>
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="alternative-badge">${alt.bestValue ? 'Best Value' : 'Great Deal'}</span>
                            ${alt.bestValue ? '<span class="alternative-badge" style="background: #fff3cd; color: #856404;">Most Popular</span>' : ''}
                        </div>
                    </div>
                `;
            });
            
            alternativesHTML += `
                    </div>
                    <p style="margin-top: 15px; font-size: 13px; color: #666;">Click on any option to view full details and book. All packages include flights and hotel.</p>
                </div>
            `;
            
                messageDiv.innerHTML = alternativesHTML;
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }, 1000);
        }

        function selectAlternative(index, dates, price) {
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                setTimeout(() => {
                    const dateParts = dates.split('-');
                    const monthDay = dateParts[0].split(' ');
                    const startDay = parseInt(monthDay[1]);
                    const endDay = parseInt(dateParts[1]);
                    showItineraryCard(startDay, endDay, price);
                }, 1000);
            }, 1000);
        }

        function processUserMessage(message) {
            const lowerMessage = message.toLowerCase();
            
            setTimeout(() => {
                // If user is asking for trip details, show the calendar first
                if (lowerMessage.includes('trip') || lowerMessage.includes('goa') || lowerMessage.includes('date') || lowerMessage.includes('november')) {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        showCalendarHeatmap();
                        setTimeout(() => {
                            showBotMessage("I found some great options! The calendar shows prices by day. Drag to select your preferred dates (Nov 12-18 looks great!).");
                        }, 800);
                    }, 800);
                    return;
                }
                if (lowerMessage.includes('book') || lowerMessage.includes('confirm')) {
                    if (bookingStep === 0) {
                        showBotMessage("Please select your travel dates from the calendar first!");
                    } else if (bookingStep === 1) {
                        showTravelerForm();
                    }
                } else if (lowerMessage.includes('cheap') || lowerMessage.includes('price')) {
                    showBotMessage("The cheapest dates in November are Nov 12-18. The total price for 6 days for a couple is calculated based on daily rates. This includes flights and a 4-star hotel. Would you like to book this?");
                } else {
                    showBotMessage("I can help you find the best travel dates! Try selecting dates from the calendar above, or ask me about prices, alternatives, or booking options.");
                }
            }, 1000);
        }

        // Initialize - Simulate user message
        setTimeout(() => {
            const initial = "I need the cheapest 5-7 day Goa trip in November under â‚¹30k from Bangalore for a couple";
            typeAndSendMessage(initial);
        }, 1200);
    </script>
</body>
</html>
