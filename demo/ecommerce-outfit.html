<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lyntra - Complete the Look</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f6; /* Lyntra-like neutral background */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }

        .header {
            background: #ffffff;
            color: #282c3f;
            padding: 14px 24px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #eaeaec;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: #FF3F6C;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #FF3F6C;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .bundle-builder {
            margin-top: 15px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .bundle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .bundle-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .offer-badge {
            background: linear-gradient(135deg, #FF3F6C 0%, #FF6B9D 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .carousel {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding-bottom: 6px;
            margin: 0;
            scroll-behavior: smooth;
        }

        .carousel::-webkit-scrollbar { height: 8px; }
        .carousel::-webkit-scrollbar-thumb { background: #e0e0e0; border-radius: 8px; }

        .outfit-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            min-width: 200px; /* carousel card width - increased */
            scroll-snap-align: start;
        }

        .outfit-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .outfit-item.selected {
            border-color: #FF3F6C;
            background: #fff5f7;
        }

        .carousel-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .carousel-wrapper {
            position: relative;
            margin-bottom: 12px;
        }

        .carousel-controls {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            display: flex;
            gap: 0;
        }

        .carousel-controls.left {
            left: -15px;
        }

        .carousel-controls.right {
            right: -15px;
        }

        .control-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid #e0e0e0;
            background: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #f5f5f6;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .item-image {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 6px;
            background: #f0f0f0;
            height: 100px; /* reduced height */
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-title {
            font-size: 12px;
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
        }

        .item-price {
            font-size: 14px;
            font-weight: 700;
            color: #FF3F6C;
        }

        .item-original-price {
            font-size: 11px;
            color: #999;
            text-decoration: line-through;
            margin-left: 5px;
        }

        .item-category {
            font-size: 10px;
            color: #666;
            margin-top: 3px;
        }

        .price-summary {
            background: linear-gradient(135deg, #FF3F6C 0%, #FF6B9D 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .price-row.total {
            font-size: 20px;
            font-weight: 700;
            padding-top: 15px;
            border-top: 2px solid rgba(255,255,255,0.3);
            margin-top: 10px;
        }

        .discount-highlight {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
        }

        .cart-view {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .cart-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            background: #f0f0f0;
        }

        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: #FF3F6C;
            font-weight: 600;
        }

        .cart-summary {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .payment-form {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .form-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: #FF3F6C;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .payment-method {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .payment-method:hover {
            border-color: #FF3F6C;
        }

        .payment-method.selected {
            border-color: #FF3F6C;
            background: #fff5f7;
        }

        .confirmation-card {
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
            color: white;
            border-radius: 16px;
            padding: 30px;
            margin-top: 15px;
            text-align: center;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #FF3F6C;
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 63, 108, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #FF3F6C;
            border: 2px solid #FF3F6C;
        }

        .btn-secondary:hover {
            background: #fff5f7;
        }

        .input-container {
            padding: 20px 30px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .input-field {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 24px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .input-field:focus {
            border-color: #FF3F6C;
        }

        .send-btn {
            padding: 12px 24px;
            background: #FF3F6C;
            color: white;
            border: none;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .send-btn:hover {
            background: #e02e5a;
            transform: translateY(-1px);
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 18px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>
        <div class="container">
            <div class="chat-container" id="chatContainer">
            <div class="message bot">
                <div class="message-content">
                    <p>Hi! I'll help you create a perfect casual Friday outfit within your budget. Let me curate some options for you...</p>
                </div>
            </div>
        </div>
        <div class="input-container">
            <input type="text" class="input-field" id="userInput" placeholder="Type your message..." onkeypress="handleKeyPress(event)" value="I need a casual Friday outfit, ‚Çπ6‚Äì7k.">
            <button class="send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        let selectedItems = {
            top: null,
            bottom: null,
            shoes: null
        };
        let flowStep = 0; // 0: bundle, 1: cart, 2: payment, 3: confirmation

        const outfitOptions = {
            top: [
                { id: 1, name: "Casual Blue Shirt", price: 1899, originalPrice: 2499, image: "https://images.unsplash.com/photo-1594938291221-94f313b5ca73?w=200&h=200&fit=crop", category: "Top" },
                { id: 2, name: "Polo T-Shirt", price: 1299, originalPrice: 1799, image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=200&h=200&fit=crop", category: "Top" },
                { id: 3, name: "Denim Shirt", price: 2199, originalPrice: 2999, image: "https://images.unsplash.com/photo-1603252109303-2751441dd157?w=200&h=200&fit=crop", category: "Top" }
            ],
            bottom: [
                { id: 1, name: "Chinos", price: 2499, originalPrice: 3299, image: "https://images.unsplash.com/photo-1473966968600-fa801b869a1a?w=200&h=200&fit=crop", category: "Bottom" },
                { id: 2, name: "Jeans", price: 1999, originalPrice: 2799, image: "https://images.unsplash.com/photo-1541099649105-f69ad21f3246?w=200&h=200&fit=crop", category: "Bottom" },
                { id: 3, name: "Cargo Pants", price: 2299, originalPrice: 2999, image: "https://images.unsplash.com/photo-1552902865-b72c031ac5ea?w=200&h=200&fit=crop", category: "Bottom" }
            ],
            shoes: [
                { id: 1, name: "Casual Sneakers", price: 2499, originalPrice: 3499, image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=200&h=200&fit=crop", category: "Shoes" },
                { id: 2, name: "Loafers", price: 1999, originalPrice: 2799, image: "https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?w=200&h=200&fit=crop", category: "Shoes" },
                { id: 3, name: "Canvas Shoes", price: 1499, originalPrice: 1999, image: "https://images.unsplash.com/photo-1608231387042-66d1773070a5?w=200&h=200&fit=crop", category: "Shoes" }
            ]
        };

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;

            addUserMessage(message);
            input.value = '';

            setTimeout(() => {
                processUserMessage(message);
            }, 500);
        }

        function typeAndSendMessage(msg, typingSpeed = 35) {
            const input = document.getElementById('userInput');
            const sendBtn = document.querySelector('.send-btn');
            input.value = '';
            let i = 0;
            const interval = setInterval(() => {
                input.value = msg.slice(0, i + 1);
                i++;
                if (i >= msg.length) {
                    clearInterval(interval);
                    setTimeout(() => { if (sendBtn) sendBtn.click(); else sendMessage(); }, 200);
                }
            }, typingSpeed);
        }

        function addUserMessage(text) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `<div class="message-content">${text}</div>`;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showBotMessage(text) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = `<div class="message-content">${text}</div>`;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showBundleBuilder() {
            flowStep = 0;
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            let outfitHTML = `
                <div class="message-content">
                    <p>Perfect! I've curated a complete outfit bundle for you. Select items from each category:</p>
                    <div class="bundle-builder">
                        <div class="bundle-header">
                            <div class="bundle-title">Complete the Look</div>
                            <div class="offer-badge">üéÅ Bundle Offer: 15% OFF</div>
                        </div>
                        <div id="outfitPreview">
            `;

            // Top section
            outfitHTML += `
                <div>
                    <div class="carousel-header">
                        <div style="font-size: 12px; font-weight: 700; color: #282c3f;">TOP</div>
                    </div>
                    <div class="carousel-wrapper">
                        <div class="carousel-controls left">
                            <button class="control-btn" onclick="scrollCarousel('top', -1)">‚óÄ</button>
                        </div>
                        <div class="carousel" id="carousel-top">
            `;
            outfitOptions.top.forEach(item => {
                outfitHTML += `
                    <div class="outfit-item" onclick="selectItem('top', ${item.id})" id="top-${item.id}">
                        <div class="item-image">
                            <img src="${item.image}" alt="${item.name}" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1520975916090-3105956dac38?w=300&h=300&fit=crop';">
                        </div>
                        <div class="item-title">${item.name}</div>
                        <div>
                            <span class="item-price">‚Çπ${item.price.toLocaleString()}</span>
                            <span class="item-original-price">‚Çπ${item.originalPrice.toLocaleString()}</span>
                        </div>
                        <div class="item-category">${item.category}</div>
                    </div>
                `;
            });
            outfitHTML += `
                        </div>
                        <div class="carousel-controls right">
                            <button class="control-btn" onclick="scrollCarousel('top', 1)">‚ñ∂</button>
                        </div>
                    </div>
                </div>`;

            // Bottom section
            outfitHTML += `
                <div>
                    <div class="carousel-header">
                        <div style="font-size: 12px; font-weight: 700; color: #282c3f;">BOTTOM</div>
                    </div>
                    <div class="carousel-wrapper">
                        <div class="carousel-controls left">
                            <button class="control-btn" onclick="scrollCarousel('bottom', -1)">‚óÄ</button>
                        </div>
                        <div class="carousel" id="carousel-bottom">
            `;
            outfitOptions.bottom.forEach(item => {
                outfitHTML += `
                    <div class="outfit-item" onclick="selectItem('bottom', ${item.id})" id="bottom-${item.id}">
                        <div class="item-image">
                            <img src="${item.image}" alt="${item.name}" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1520975916090-3105956dac38?w=300&h=300&fit=crop';">
                        </div>
                        <div class="item-title">${item.name}</div>
                        <div>
                            <span class="item-price">‚Çπ${item.price.toLocaleString()}</span>
                            <span class="item-original-price">‚Çπ${item.originalPrice.toLocaleString()}</span>
                        </div>
                        <div class="item-category">${item.category}</div>
                    </div>
                `;
            });
            outfitHTML += `
                        </div>
                        <div class="carousel-controls right">
                            <button class="control-btn" onclick="scrollCarousel('bottom', 1)">‚ñ∂</button>
                        </div>
                    </div>
                </div>`;

            // Shoes section
            outfitHTML += `
                <div>
                    <div class="carousel-header">
                        <div style="font-size: 12px; font-weight: 700; color: #282c3f;">SHOES</div>
                    </div>
                    <div class="carousel-wrapper">
                        <div class="carousel-controls left">
                            <button class="control-btn" onclick="scrollCarousel('shoes', -1)">‚óÄ</button>
                        </div>
                        <div class="carousel" id="carousel-shoes">
            `;
            outfitOptions.shoes.forEach(item => {
                outfitHTML += `
                    <div class="outfit-item" onclick="selectItem('shoes', ${item.id})" id="shoes-${item.id}">
                        <div class="item-image">
                            <img src="${item.image}" alt="${item.name}" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1520975916090-3105956dac38?w=300&h=300&fit=crop';">
                        </div>
                        <div class="item-title">${item.name}</div>
                        <div>
                            <span class="item-price">‚Çπ${item.price.toLocaleString()}</span>
                            <span class="item-original-price">‚Çπ${item.originalPrice.toLocaleString()}</span>
                        </div>
                        <div class="item-category">${item.category}</div>
                    </div>
                `;
            });
            outfitHTML += `
                        </div>
                        <div class="carousel-controls right">
                            <button class="control-btn" onclick="scrollCarousel('shoes', 1)">‚ñ∂</button>
                        </div>
                    </div>
                </div>`;

            outfitHTML += `
                        </div>
                        ${getPriceSummary()}
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="addToCart()" id="addBundleBtn" disabled>Add Bundle to Cart</button>
                            <button class="btn btn-secondary" onclick="showAlternatives()">See More Options</button>
                        </div>
                    </div>
                </div>
            `;

            messageDiv.innerHTML = outfitHTML;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function selectItem(category, itemId) {
            const prevItem = selectedItems[category];
            // Deselect if clicking the same item
            if (prevItem === itemId) {
                const prevElement = document.getElementById(`${category}-${prevItem}`);
                if (prevElement) prevElement.classList.remove('selected');
                selectedItems[category] = null;
            } else {
                // Remove previous selection
                if (prevItem) {
                    const prevElement = document.getElementById(`${category}-${prevItem}`);
                    if (prevElement) prevElement.classList.remove('selected');
                }
                // Add new selection
                selectedItems[category] = itemId;
                const element = document.getElementById(`${category}-${itemId}`);
                if (element) element.classList.add('selected');
            }

            updatePriceSummary();

            const allSelected = selectedItems.top && selectedItems.bottom && selectedItems.shoes;
            const btn = document.getElementById('addBundleBtn');
            if (btn) {
                btn.disabled = !allSelected;
            }
        }

        function scrollCarousel(category, dir) {
            const el = document.getElementById(`carousel-${category}`);
            if (!el) return;
            const cardWidth = 212; // card width (200px) + gap (12px)
            el.scrollBy({ left: dir * cardWidth, behavior: 'smooth' });
        }

        function getPriceSummary() {
            let subtotal = 0;
            let originalTotal = 0;

            ['top', 'bottom', 'shoes'].forEach(category => {
                const itemId = selectedItems[category];
                if (itemId) {
                    const item = outfitOptions[category].find(i => i.id === itemId);
                    if (item) {
                        subtotal += item.price;
                        originalTotal += item.originalPrice;
                    }
                }
            });

            const discount = originalTotal - subtotal;
            const bundleDiscount = Math.round(subtotal * 0.15);
            const finalPrice = subtotal - bundleDiscount;
            const totalSavings = discount + bundleDiscount;

            return `
                <div class="price-summary">
                    <div class="price-row">
                        <span>Subtotal</span>
                        <span>‚Çπ${subtotal.toLocaleString()}</span>
                    </div>
                    ${discount > 0 ? `
                    <div class="price-row" style="color: #c8e6c9;">
                        <span>Item Discounts</span>
                        <span>-‚Çπ${discount.toLocaleString()}</span>
                    </div>
                    ` : ''}
                    <div class="price-row" style="color: #c8e6c9;">
                        <span>Bundle Discount (15%)</span>
                        <span>-‚Çπ${bundleDiscount.toLocaleString()}</span>
                    </div>
                    <div class="price-row total">
                        <span>Total</span>
                        <span>‚Çπ${finalPrice.toLocaleString()}</span>
                    </div>
                    <div class="discount-highlight">
                        üí∞ You save ‚Çπ${totalSavings.toLocaleString()} on this bundle!
                    </div>
                </div>
            `;
        }

        function updatePriceSummary() {
            const priceSummary = document.querySelector('.price-summary');
            if (priceSummary) {
                priceSummary.outerHTML = getPriceSummary();
            }
        }

        function showTypingIndicator() {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.id = 'typingIndicator';
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function addToCart() {
            if (!selectedItems.top || !selectedItems.bottom || !selectedItems.shoes) {
                showBotMessage("Please select one item from each category (Top, Bottom, Shoes) to complete your bundle!");
                return;
            }

            flowStep = 1;
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                showCartView();
            }, 1000);
        }

        function showCartView() {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const top = outfitOptions.top.find(i => i.id === selectedItems.top);
            const bottom = outfitOptions.bottom.find(i => i.id === selectedItems.bottom);
            const shoes = outfitOptions.shoes.find(i => i.id === selectedItems.shoes);
            
            let subtotal = top.price + bottom.price + shoes.price;
            let bundleDiscount = Math.round(subtotal * 0.15);
            let finalPrice = subtotal - bundleDiscount;
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <p>Your bundle has been added to cart! Review your items:</p>
                    <div class="cart-view">
                        <div class="cart-item">
                            <div class="cart-item-image">
                                <img src="${top.image}" alt="${top.name}" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1520975916090-3105956dac38?w=200&h=200&fit=crop';">
                            </div>
                            <div class="cart-item-details">
                                <div class="cart-item-name">${top.name}</div>
                                <div class="cart-item-price">‚Çπ${top.price.toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="cart-item">
                            <div class="cart-item-image">
                                <img src="${bottom.image}" alt="${bottom.name}" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1520975916090-3105956dac38?w=200&h=200&fit=crop';">
                            </div>
                            <div class="cart-item-details">
                                <div class="cart-item-name">${bottom.name}</div>
                                <div class="cart-item-price">‚Çπ${bottom.price.toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="cart-item">
                            <div class="cart-item-image">
                                <img src="${shoes.image}" alt="${shoes.name}" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1520975916090-3105956dac38?w=200&h=200&fit=crop';">
                            </div>
                            <div class="cart-item-details">
                                <div class="cart-item-name">${shoes.name}</div>
                                <div class="cart-item-price">‚Çπ${shoes.price.toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="cart-summary">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Subtotal</span>
                                <span>‚Çπ${subtotal.toLocaleString()}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; color: #4caf50;">
                                <span>Bundle Discount (15%)</span>
                                <span>-‚Çπ${bundleDiscount.toLocaleString()}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 18px; padding-top: 10px; border-top: 2px solid #f0f0f0;">
                                <span>Total</span>
                                <span>‚Çπ${finalPrice.toLocaleString()}</span>
                            </div>
                        </div>
                        <div class="action-buttons" style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="showPaymentForm()">Proceed to Checkout</button>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showPaymentForm() {
            flowStep = 2;
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <p>Complete your purchase:</p>
                    <div class="payment-form">
                        <div class="form-title">Delivery & Payment</div>
                        <div class="form-group">
                            <label class="form-label">Delivery Address</label>
                            <input type="text" class="form-input" id="address" placeholder="Enter your delivery address" value="123 Main Street, Bangalore - 560001">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-input" id="phone" placeholder="+91 98765 43210" value="+91 98765 43210">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pincode</label>
                                <input type="text" class="form-input" id="pincode" placeholder="560001" value="560001">
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <label class="form-label">Payment Method</label>
                            <div class="payment-methods">
                                <div class="payment-method selected" onclick="selectPaymentMethod('card', this)">
                                    <div style="font-size: 24px; margin-bottom: 5px;">üí≥</div>
                                    <div style="font-size: 12px;">Card</div>
                                </div>
                                <div class="payment-method" onclick="selectPaymentMethod('upi', this)">
                                    <div style="font-size: 24px; margin-bottom: 5px;">üì±</div>
                                    <div style="font-size: 12px;">UPI</div>
                                </div>
                                <div class="payment-method" onclick="selectPaymentMethod('cod', this)">
                                    <div style="font-size: 24px; margin-bottom: 5px;">üí∞</div>
                                    <div style="font-size: 12px;">COD</div>
                                </div>
                            </div>
                        </div>
                        <div id="cardDetails" style="margin-top: 20px;">
                            <div class="form-group">
                                <label class="form-label">Card Number</label>
                                <input type="text" class="form-input" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Expiry Date</label>
                                    <input type="text" class="form-input" id="expiry" placeholder="MM/YY" maxlength="5">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">CVV</label>
                                    <input type="text" class="form-input" id="cvv" placeholder="123" maxlength="3">
                                </div>
                            </div>
                        </div>
                        <div class="action-buttons" style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="processPayment()">Place Order</button>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function selectPaymentMethod(method, element) {
            document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            
            const cardDetails = document.getElementById('cardDetails');
            if (method === 'card') {
                cardDetails.style.display = 'block';
            } else {
                cardDetails.style.display = 'none';
            }
        }

        function processPayment() {
            flowStep = 3;
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                showConfirmation();
            }, 2000);
        }

        function showConfirmation() {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="confirmation-card">
                        <div style="font-size: 64px; margin-bottom: 15px;">‚úÖ</div>
                        <div style="font-size: 24px; font-weight: 700; margin-bottom: 10px;">Order Placed Successfully!</div>
                        <p style="opacity: 0.9; margin-bottom: 20px;">Your order has been confirmed and will be delivered within 3-5 business days.</p>
                        <div style="background: rgba(255,255,255,0.2); border-radius: 12px; padding: 20px; margin-top: 20px; text-align: left;">
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.2);">
                                <span>Order ID</span>
                                <span style="font-weight: 600;">LYN-2024-001234</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.2);">
                                <span>Total Amount</span>
                                <span style="font-weight: 600;">‚Çπ5,525</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0;">
                                <span>Payment Status</span>
                                <span style="font-weight: 600;">Paid</span>
                            </div>
                        </div>
                        <p style="margin-top: 20px; font-size: 14px; opacity: 0.9;">You'll receive order tracking details via SMS and email. Thank you for shopping with Lyntra! üéâ</p>
                    </div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showAlternatives() {
            showBotMessage("Here are some alternative options:\n\n‚Ä¢ Premium Bundle: ‚Çπ8,500 (20% off)\n‚Ä¢ Budget Bundle: ‚Çπ5,200 (10% off)\n‚Ä¢ Designer Bundle: ‚Çπ12,000 (25% off)\n\nWould you like to see details for any of these?");
        }

        function processUserMessage(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('outfit') || lowerMessage.includes('casual') || lowerMessage.includes('friday')) {
                setTimeout(() => {
                    showBundleBuilder();
                }, 1000);
            } else if (lowerMessage.includes('add') || lowerMessage.includes('cart')) {
                addToCart();
            } else if (lowerMessage.includes('checkout') || lowerMessage.includes('pay')) {
                if (flowStep >= 1) {
                    showPaymentForm();
                } else {
                    showBotMessage("Please add items to cart first!");
                }
            } else {
                showBotMessage("I can help you build a complete outfit! Try asking for a casual Friday outfit, or browse the bundle builder above to select items.");
            }
        }

        // Auto-start with typing simulation
        setTimeout(() => {
            const initial = "I need a casual Friday outfit, ‚Çπ6‚Äì7k.";
            typeAndSendMessage(initial);
        }, 900);
    </script>
</body>
</html>
